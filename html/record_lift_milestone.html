<!DOCTYPE html>
<html lang="en">

<head>
    <title>Record Milestone</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/record_lift_milestone.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

</head>

<body>

<div class = "wrapper">

    <div class ="item item01 banner" id ="navBarLeft"> <a href= "file:home2.html"> <span id ="home"> sweatbank </span> </a> </div>
    <div class ="item item02 banner" id ="navBarMid"> </div>
    <div class ="item item03 banner" id ="navBarRight"> <a href= "file:sweatbank_profile.html"><img src="images/person_head.svg" id="profileIcon"> </a> </div>


    <div class ="item titleDiv"> <div class = "innerSectionTitleDiv firstRow"><span class = "sectionTitle">goal</span></div> </div>

    <div class ="item contentDiv">
        <div class = "firstRow">
            <span class = "staticText previousInput goal lift"> squat </span> &nbsp
            <span class = "staticText previousInput goal goalWeight"> 255 </span> &nbsp
            <span class = "staticText previousInput goal units"> lbs </span> &nbsp
            <span class = "staticText previousInput goal reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>

    <div class ="item titleDiv"> <div class = "innerSectionTitleDiv"><span class = "sectionTitle">baseline</span></div> </div>

    <div class ="item contentDiv">
        <div class = "">
            <span class = "staticText previousInput baseline lift"> squat </span> &nbsp
            <span class = "staticText previousInput baseline baselineWeight"> 175 </span> &nbsp
            <span class = "staticText previousInput baseline units"> lbs </span> &nbsp
            <span class = "staticText previousInput baseline reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>


    <!-- <div class ="item titleDiv"> <div class = "innerSectionTitleDiv"><span class = "sectionTitle">last milestone</span></div> </div>

    <div class ="item contentDiv">
        <div class = "">
            <span class = "staticText previousInput lastMilestone lift"> squat </span> &nbsp
            <span class = "staticText previousInput lastMilestone lastMilestoneWeight"> 185 </span> &nbsp
            <span class = "staticText previousInput lastMilestone units"> lbs </span> &nbsp
            <span class = "staticText previousInput lastMilestone reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div> -->



    <div class ="item titleDiv"> <div class = "innerSectionTitleDiv"><span class = "sectionTitle">this milestone</span></div> </div>

    <div class ="item contentDiv">
        <div class = "">
            <span class = "staticText previousInput thisMilestone lift"> squat </span> &nbsp
            <form class = "userInput"><input class ="exerciseInput" id = "thisMilestoneWeight" type ="text" placeholder="205" autofocus></form> &nbsp
            <span class = "staticText previousInput thisMilestone units"> lbs </span> &nbsp
            <span class = "staticText previousInput thisMilestone reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>

    <div class ="item titleDiv"> <div class = "innerSectionTitleDiv"><span class = "sectionTitle">today</span></div> </div>

    <div class ="item contentDiv"> <div class = "" id = "today"> <span>  </span> </div> </div>

    <div class ="item titleDiv"> <div class = "innerSectionTitleDiv"><span class = "sectionTitle">goal end date</span></div> </div>

    <div class ="item contentDiv"><div class = "" id = "goalEndDate"> <span>  </span> </div></div>


    <div class ="item titleDiv"> <div class = "innerSectionTitleDiv"><span class = "sectionTitle">days remaining</span></div></div>

    <div class ="item contentDiv"> <div id = "daysLeft"> <span> 5 </span> </div></div>

    <div class ="item titleDiv">
        <div class = "buttonSection"> <button class = "submit disallowed"> record milestone </button>
        </div>
    </div>
    <div class ="item contentDiv">
        <div class = "iconSection">
            <svg class = "goalTypeIcon" witodayh="135.38mm" height="135.47mm" version="1.1" viewBox="0 0 135.38425 135.46654" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(100.95 -81.1)">
            <g transform="matrix(.26458 0 0 .26458 -101 81.1)">
            <path d="m284.71 418.36-190.92-190.92c-11.715-11.715-30.71-11.715-42.425 0-11.717 11.717-11.717 30.712 0 42.427l190.92 190.92c11.715 11.715 30.71 11.715 42.426 0 11.717-11.715 11.717-30.71 0-42.426zm175.92-176.23-190.92-190.92c-11.715-11.715-30.711-11.715-42.426 0-11.717 11.717-11.717 30.71 0 42.427l190.92 190.92c11.715 11.715 30.71 11.715 42.426 0 11.717-11.715 11.717-30.71 0-42.427zm-190.92-63.639-91.066 91.376 63.64 63.64 91.066-91.378zm-69.853 282.29-148.49-148.49c-11.717-11.715-30.71-11.715-42.427 0-11.715 11.717-11.715 30.712 0 42.427l42.345 42.345-31.765 31.752c-2.813 2.813-4.395 6.621-4.395 10.605s1.582 7.793 4.395 10.605l42.612 42.598c2.929 2.931 6.767 4.396 10.605 4.396s7.676-1.465 10.605-4.395l31.752-31.752 42.338 42.339c11.715 11.715 30.71 11.715 42.426 0 11.717-11.717 11.717-30.712 0-42.427zm303.2-303.51-42.338-42.338 31.827-31.815c2.814-2.811 4.396-6.62 4.396-10.604s-1.582-7.793-4.395-10.605l-42.612-42.612c-5.625-5.625-15.586-5.625-21.211 0l-31.815 31.827-42.344-42.346c-11.715-11.715-30.71-11.715-42.426 0-11.717 11.715-11.717 30.71 0 42.426l148.49 148.49c11.717 11.715 30.712 11.715 42.427 0s11.715-30.71 0-42.426z"/>
            </g>
            </g>
            </svg>
        </div>
    </div>
    <div class ="item bottomRow"></div>


<script>

// Functions

var timeframe = 10 // duration of goal, in days
var daysIn = 4 // pretend scenario

var today = new Date();
var todayStr = (today.getMonth() + 1) + "/" + today.getDate() + "/" + today.getFullYear()
// month is getMonth() + 1 because JavaScript thinks January is 0

var startDate = new Date()
startDate.setDate(today.getDate() - daysIn)
var startDateStr = (startDate.getMonth() + 1) + "/" + startDate.getDate() + "/" + startDate.getFullYear()

var endDate = new Date()
endDate.setDate(startDate.getDate() + timeframe)
var endDateStr = (endDate.getMonth() + 1) + "/" + endDate.getDate() + "/" + endDate.getFullYear()

var daysLeft = endDate.getDate() - today.getDate()

$("#today").html(todayStr)
$("#goalEndDate").html(endDateStr)
$("#daysLeft").html(daysLeft)

function resizeInput() {
    if($(this).val().length>=1){ $(this).attr('size', $(this).val().length+2); } // buffer can be added if need be (3 = 3 pixels)
    else { $(this).attr('size', $(this).attr('placeholder').length+2); }
}

function startSizeInput() { $(this).attr('size', $(this).attr('placeholder').length+2); }

function changeBackground(){
    if($(this).val().length>0 & !isNaN($(this).val())){
        $(this).css('background-color','#8A94B9')
        $(".bigIcon").css('opacity',1)
    } else {
        $(this).css('background-color','#C6C0CA')
        $(".bigIcon").css('opacity',.3)
    }
}

function allowSubmit(){
    if($(".bigIcon").css("opacity") == 1) { $(".submit").removeClass("disallowed") }
    else { $(".submit").addClass("disallowed") }
}

var weightlifting = { // will be passed in from DB
    lift:"bench press",
    goalWeight:"",
    reps:"",
    units:"",
    baselineWeight:"",
    thisMilestoneWeight:""
}

// these shouldn't be defined and calculated in this page
// ... where should they be calculated? in a "goals" microservice?

var goalStatus = {
    startDate: startDate,
    endDate: endDate,
    daysLeft: daysLeft,
    goalComplete: "",
}

var goal = {
    goalID: "",
    completeGoalString: "",
    goalType: weightlifting, //
    status: goalStatus
}


var liftObject = {
    userID:"", // do we want this associated with each goal object?
    goalID:"",
    completeGoalString:"",
    goalType: "weightlifting",
    goalStatus: "", // options: in-progress, achieved, expired
    dateAchieved:"", // not needed for any basic functionality, but could be useful for backwards-looking dashboard
    depositPaid:"", // payment-related, think about this down the road
    lift: "squat", //
    reps: "5",
    units:"lbs",
    goalWeight:"250",
    baselineWeight:"175",
    thisMilestoneWeight:"225",
    startDate:"",
    endDate:""
}

// occurs on page load
function fillMilestoneFields(){
    $(".lift").html(goal['goalType'].lift)
    $(".goalWeight").html(liftObject.goalWeight)
    $(".baselineWeight").html(liftObject.baselineWeight)
    $(".lastMilestoneWeight").html(liftObject.thisMilestoneWeight)
    $("#thisMilestoneWeight").attr('placeholder',liftObject.thisMilestoneWeight)
    $(".units").html(liftObject.units)
    $(".reps").html(liftObject.reps)
}

// occurs on button click
function sendGoalToDB(){
  $.ajax({
        url: "http://ec2-54-204-66-243.compute-1.amazonaws.com/admin/goals",
        type: "POST",
        data: liftObjectJSON,
        dataType: 'json', // lowercase is always preferered though jQuery does it, too.
        success: function(){},
        error: function(){}
    });
}

// Event Handlers

$('window')
    // .on('load',getGoalFromDB())
    // .on('load',parseLiftObject())
    .on('load',fillMilestoneFields())

    // .on('load',startSizeInput())

$('input[type="text"]')
    .keyup(resizeInput)
    .keyup(changeBackground)
    .keyup(allowSubmit)
    // .keyup(rewriteLiftObject)
    .each(startSizeInput)

$('.submit')
    .click(sendGoalToDB) // should there be a confirm milestone step? what page should appear after clicking this button?

// DATABASE INTERACTION / AJAX REQUEST SECTION

// function getGoalFromDB(){
//   $.ajax({
//         url: "http://ec2-54-204-66-243.compute-1.amazonaws.com/admin/goals",
//         type: "GET",
//         data: liftObjectJSON, // how do we retrieve a specific lift object, based on a goal ID that was selected on the last page?
//         dataType: 'json', // lowercase is always preferered though jQuery does it, too.
//         success: function(){},
//         error: function(){}
//     });
// }

// function parseLiftObject(){
//     var liftObject = JSON.parse(liftObjectJSON) // when parsed, can we still reference the JSON object, or does it need to be stringified again?
// }

// //unless we decide to add a last milestone date field, this is the only property that needs to be re-written based on user input
// function rewriteLiftObject(){
//     liftObject.thisMilestoneWeight = Number($("#thisMilestoneWeight").val()) // nothing else should change
//     liftObjectJSON = JSON.stringify(liftObject)
// }


</script>

</div>

</body>
</html>
