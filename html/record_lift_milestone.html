<!DOCTYPE html>
<html lang="en">

<head>
    <title>Record Milestone</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/record_lift_milestone.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

</head>

<body>

<div class = "wrapper">

    <div class ="item item0 banner" id ="navBarLeft"> <a href= "file:home2.html"> <span id ="home"> sweatbank </span> </a> </div>
    <div class ="item item0 banner" id ="navBarMid"> </div>
    <div class ="item item0 banner" id ="navBarRight"> <a href= "file:sweatbank_profile.html"><img src="images/person_head.svg" id="profileIcon"> </a> </div>

    <div class ="item item1">
        <div class = "innerSectionTitleDiv firstRow"><span class = "sectionTitle">goal</span></div>
    </div>

    <div class ="item item2">
        <div class = "firstRow">
            <span class = "staticText previousInput goal lift"> squat </span> &nbsp
            <span class = "staticText previousInput goal goalWeight"> 255 </span> &nbsp
            <span class = "staticText previousInput goal units"> lbs </span> &nbsp
            <span class = "staticText previousInput goal reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>
    <div class ="item item3">
        <div class = "iconSection firstRow">
            <svg class = "bigIcon" width="135.38mm" height="135.47mm" version="1.1" viewBox="0 0 135.38425 135.46654" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(100.95 -81.1)">
            <g transform="matrix(.26458 0 0 .26458 -101 81.1)">
            <path d="m284.71 418.36-190.92-190.92c-11.715-11.715-30.71-11.715-42.425 0-11.717 11.717-11.717 30.712 0 42.427l190.92 190.92c11.715 11.715 30.71 11.715 42.426 0 11.717-11.715 11.717-30.71 0-42.426zm175.92-176.23-190.92-190.92c-11.715-11.715-30.711-11.715-42.426 0-11.717 11.717-11.717 30.71 0 42.427l190.92 190.92c11.715 11.715 30.71 11.715 42.426 0 11.717-11.715 11.717-30.71 0-42.427zm-190.92-63.639-91.066 91.376 63.64 63.64 91.066-91.378zm-69.853 282.29-148.49-148.49c-11.717-11.715-30.71-11.715-42.427 0-11.715 11.717-11.715 30.712 0 42.427l42.345 42.345-31.765 31.752c-2.813 2.813-4.395 6.621-4.395 10.605s1.582 7.793 4.395 10.605l42.612 42.598c2.929 2.931 6.767 4.396 10.605 4.396s7.676-1.465 10.605-4.395l31.752-31.752 42.338 42.339c11.715 11.715 30.71 11.715 42.426 0 11.717-11.717 11.717-30.712 0-42.427zm303.2-303.51-42.338-42.338 31.827-31.815c2.814-2.811 4.396-6.62 4.396-10.604s-1.582-7.793-4.395-10.605l-42.612-42.612c-5.625-5.625-15.586-5.625-21.211 0l-31.815 31.827-42.344-42.346c-11.715-11.715-30.71-11.715-42.426 0-11.717 11.715-11.717 30.71 0 42.426l148.49 148.49c11.717 11.715 30.712 11.715 42.427 0s11.715-30.71 0-42.426z"/>
            </g>
            </g>
            </svg>
        </div>
    </div>

    <div class ="item item5">
        <div class = "innerSectionTitleDiv"><span class = "sectionTitle">baseline</span></div>
    </div>

    <div class ="item item6">
        <div class = "">
            <span class = "staticText previousInput baseline lift"> squat </span> &nbsp
            <span class = "staticText previousInput baseline baselineWeight"> 185 </span> &nbsp
            <span class = "staticText previousInput baseline reps"> lbs </span> &nbsp
            <span class = "staticText previousInput baseline units"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>

    <div class ="item item9">
        <div class = "innerSectionTitleDiv"><span class = "sectionTitle">last milestone</span></div>
    </div>

    <div class ="item item10">
        <div class = "">
            <span class = "staticText previousInput lastMilestone lift"> squat </span> &nbsp
            <span class = "staticText previousInput lastMilestone lastMilestoneWeight"> 205 </span> &nbsp
            <span class = "staticText previousInput lastMilestone units"> lbs </span> &nbsp
            <span class = "staticText previousInput lastMilestone reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>

    <div class ="item item13">
        <div class = "innerSectionTitleDiv"><span class = "sectionTitle">this milestone</span></div>
    </div>

    <div class ="item item14">
        <div class = "">
            <span class = "staticText previousInput thisMilestone lift"> squat </span> &nbsp
            <form class = "userInput"><input class ="exerciseInput" id = "thisMilestoneWeight" type ="text" placeholder="205" autofocus></form> &nbsp
            <span class = "staticText previousInput thisMilestone units"> lbs </span> &nbsp
            <span class = "staticText previousInput thisMilestone reps"> 5 </span> &nbsp
            <span class = "staticText goal"> times </span>
        </div>
    </div>


    <div class ="item item17">
        <div class = "innerSectionTitleDiv"><span class = "sectionTitle">today</span></div>
    </div>

    <div class ="item item18">
        <!-- <div class = ""> <span class ="date" id = "goalEndDate"> </span> </div> -->
        <div class = "" id = "today"> <span> Feb 29, 2020 </span> </div>
    </div>

    <!-- needs to populate on page load -->
    <div class ="item item21">
        <div class = "innerSectionTitleDiv"><span class = "sectionTitle">goal end date</span></div>
    </div>

    <div class ="item item22">
        <div class = "" id = "goalEndDate"> <span> March 4, 2020 </span> </div>
    </div>

    <div class ="item item23">
        <div class = "innerSectionTitleDiv"><span class = "sectionTitle">days remaining</span></div>
    </div>

    <div class ="item item24">
        <div class = ""> <span> 5 </span> </div>
    </div>

    <div class ="item item25">
        <button class = "submit disallowed"> record milestone </button>
    </div>
    <div class ="item item26"></div>
    <div class ="item item27"></div>
    <div class ="item item28"></div>
    <div class ="item item29"></div>
    <div class ="item item30"></div>
    <div class ="item item31"></div>
    <div class ="item item32"></div>
    <div class ="item item33"></div>
    <div class ="item item34"></div>
    <div class ="item item35"></div>
    <div class ="item item36"></div>

<script>

// Functions

var dt = new Date();
var day = dt.getDate()
var month = dt.getMonth()
var year = dt.getFullYear()
var dateStr = month + "/" + day + "/" + year

$("#goalEndDate").html(dateStr)

function resizeInput() {
    if($(this).val().length>=1){
        $(this).attr('size', $(this).val().length+2); // buffer can be added if need be (3 = 3 pixels)
    } else {
        $(this).attr('size', $(this).attr('placeholder').length+2);
    }
}

function startSizeInput() {
    $(this).attr('size', $(this).attr('placeholder').length+2);
}

function changeBackground(){
    if($(this).val().length>0){
        $(this).css('background-color','#8A94B9')
        $(".bigIcon").css('opacity',1)
    } else {
        $(this).css('background-color','#C6C0CA')
        $(".bigIcon").css('opacity',.3)
    }
}

function allowSubmit(){
    if($(".bigIcon").css("opacity") == 1) { $(".submit").removeClass("disallowed") }
    else { $(".submit").addClass("disallowed") }
}

// REVIEW CODE WITH SAM STARTING HERE

function getGoalFromDB(){
  $.ajax({
        url: "http://ec2-54-204-66-243.compute-1.amazonaws.com/admin/goals",
        type: "GET",
        data: liftObjectJSON, // how do we retrieve a specific lift object, based on a goal ID that was selected on the last page?
        dataType: 'json', // lowercase is always preferered though jQuery does it, too.
        success: function(){},
        error: function(){}
    });
}

function parseLiftObject(){
    var liftObject = JSON.parse(liftObjectJSON) // when parsed, can we still reference the JSON object, or does it need to be stringified again?
}

function rewriteLiftObject(){
    liftObject.thisMilestoneWeight = Number($("#thisMilestoneWeight").val()) // nothing else should change
    liftObjectJSON = JSON.stringify(liftObject)
}

function sendGoalToDB(){
  $.ajax({
        url: "http://ec2-54-204-66-243.compute-1.amazonaws.com/admin/goals",
        type: "POST",
        data: liftObjectJSON,
        dataType: 'json', // lowercase is always preferered though jQuery does it, too.
        success: function(){},
        error: function(){}
    });
}

// Event Handlers

$('window')
    .on('load',getGoalFromDB())
    .on('load',parseLiftObject())

$('input[type="text"]')
    .keyup(resizeInput)
    .keyup(allowSubmit)
    .keyup(changeBackground)
    .keyup(rewriteLiftObject)
    .each(startSizeInput)

$('.submit')
    .click(sendGoalToDB) // should there be a confirm milestone step? what page should appear after clicking this button?

</script>

</div>

</body>
</html>
