<!DOCTYPE html>
<html lang="en">

<head>
    <title>Weightlifting Goal</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/record_goal.css" />

    <!-- Fonts are hard :( -->

    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
</head>

<body>

<div class = "wrapper">

    <div class ="item item0 banner" id ="navBarLeft">
        <div class = "homelink">
            <a class = "pagelink" href= "file:home2.html"> <span id ="home"> sweatbank </span> </a>
        </div>
    </div>

    <div class ="item item0 banner" id ="navBarMid">

    </div>

    <div class ="item item0 banner" id ="navBarRight">
        <a class = "pagelink" href= "file:sweatbank_profile.html"><img src="images/person_head.svg" id="profileIcon"> </a>
    </div>

    <div class ="item item1">
        <br>

        <span class = "sectionTitle"> <img src="images/dumbbell.svg" id="goal"> </span> <br> <br>

        <span id = "goalPreface"> My goal is to </span>

        <form id = "userInput" action="" method ="">
            <input class ="exerciseInput" id = "exercise" type ="text" placeholder="squat" autofocus>
        </form>

        <form id = "userInput" action="" method ="">
            <input class ="exerciseInput" id = "weight" type ="text" placeholder="100">
        </form>

        <form id = "userInput" action="" method ="">
            <input class ="exerciseInput" id = "units" type ="text" placeholder="lbs/kg">
        </form>

        <form id = "userInput" action="" method ="">
            <input class ="exerciseInput" id = "reps" type ="text" placeholder="8">
        </form>

        <span id = "goalTimes"> times </span> <br><br>

        <ul id = "errorsList">
            <li id = "weightError"> make sure that the weight is a number! </li>
            <li id = "unitsError"> units should either be "lbs" or "kg" </li>
            <li id = "repsError"> make sure that the reps are a number! </li>
        </ul>
    </div>

    <div class ="item item2">
        <span class = "sectionTitle"> <img src="images/baseline.svg" id="baseline"> </span> <br> <br>
        <span id = "baselinePreface"> I can currently </span>
        <span id = "baselineExercise"> squat </span>
        <form id = "userInput" action="" method ="">
            <input class ="baselineInput" id = "baselineWeight" type ="text" placeholder="75">
        </form>
        <span id = "baselineUnits"> lbs/kg </span>
        <span id = "baselineLiftReps"> 8 </span>
        <span id = "baselineTimes"> times </span> <br><br>
        <span id = "baselineWeightError"> make sure that the weight is a number! </span>
    </div>

    <div class ="item item3">
        <span class = "sectionTitle"> <img src="images/timeframe.svg" id="timeframe"> </span> <br> <br>
        <span id = "timeframePreface"> I want to achieve my goal in </span> <br> <br>
        <button class = "timeframe" id="oneWeek"> 1 week </button> &nbsp
        <button class = "timeframe" id="twoWeeks"> 2 weeks </button> &nbsp
        <button class = "timeframe" id="oneMonth"> 1 month </button>

    </div>

    <div class ="item item4">
        <span class = "sectionTitle"> <img src="images/incentive.svg" id="incentive"> </span> <br><br>
        <span id = "incentiveDollarSign"> $ </span> <span id = "incentiveAmount"></span> <br> <br>
        <div class = "description">
            <span id = "incentiveDescription">
                This is the money you will put on the line for extra motivation!
            </span>
        </div>
    </div>

    <div class ="item item5">
        <span class = "sectionTitle"> <img src="images/notebook.svg" id="notes"> </span> <br> <br> <br>

        <form id = "userInput" action="" method ="">
            <textarea class ="notesInput" id = "noteArea" type ="text" placeholder="Add some words of encouragement or a note to yourself about why this is important to you (optional)."></textarea>
        </form>

    </div>

    <div class ="item item6"></div>
    <div class ="item item7">
        <br>
        <button class = "submit" id="twoWeeks"> confirm goal & select charity </button>
    </div>
    <div class ="item item8"></div>
    <div class ="item item9"></div>

<script>

var today = new Date()
var endDate = ""
var timeFrame = ""
var liftObjectJSON = ""

function setEndDate(){
    endDate = new Date(today.setDate(today.getDate() + (timeFrame * 7)))
    today = new Date()
    return endDate
}

var liftObject = {
    goalID:"",
    lift: "",
    weight:"",
    reps: "",
    units:"",
    baselineWeight:"",
    startDate:"",
    endDate:""
}

function writeLiftObject(){
    liftObject.lift = $('#exercise').val()
    liftObject.weight = $('#weight').val()
    liftObject.reps = $('#reps').val()
    liftObject.units = $('#units').val()
    liftObject.baselineWeight = $('#baselineWeight').val()
    liftObject.startDate = new Date()
    liftObject.endDate = setEndDate()
    liftObjectJSON = JSON.stringify(liftObject)
}

function changeIncentiveAmount(){
    if($("#oneWeek").hasClass("selected")){
        $("#incentiveAmount").html(5)
        timeFrame = 1
    } else if ($("#twoWeeks").hasClass("selected")){
        $("#incentiveAmount").html(10)
        timeFrame = 2
    } else if ($("#oneMonth").hasClass("selected")){
        $("#incentiveAmount").html(20)
        timeFrame = 4
    } else {
        $("#incentiveAmount").html("")
        timeFrame = 0
    }
}

function focusInput(){
    $("#exercise").focus()
}

function resizeInput() {
    if($(this).val().length>=1){
        $(this).attr('size', $(this).val().length+2); // buffer can be added if need be (3 = 3 pixels)
    } else {
        $(this).attr('size', $(this).attr('placeholder').length+2);
    }
}

function startSizeInput() {
    $(this).attr('size', $(this).attr('placeholder').length+2);
}

function changeTimes(){
    if ($('#reps').val()!=1){
        $('#goalTimes').html('times')
        $('#baselineTimes').html('times')

    } else {
        $('#goalTimes').html('time')
        $('#baselineTimes').html('time')
    }
}

function replaceBaseline(){
    if($('#exercise').val().length>=1){
        $('#baselineExercise').html($('#exercise').val())
    } else {
        $('#baselineExercise').html('squat')
    }

    if($('#units').val().length>=1){
        $('#baselineUnits').html($('#units').val())
    } else {
        $('#baselineUnits').html('lbs/kg')
    }

    if($('#reps').val().length>=1){
        $('#baselineLiftReps').html($('#reps').val())
    } else {
        $('#baselineLiftReps').html('8')
    }
}

function toggleButtonColor(){
    if ($(this).hasClass("selected")){

        $(this).css("background-color","#C6C0CA")
        $(this).css("border-color","#C6C0CA")
        $(this).css("color","grey")
        $(this).removeClass("selected")
    } else {
        $(this).css("background-color","#8A94B9")
        $(this).css("border-color","#8A94B9")
        $(this).css("color","black")
        $(this).addClass("selected")

        $(".timeframe").not(this).css("background-color","#C6C0CA")
        $(".timeframe").not(this).css("border-color","#C6C0CA")
        $(".timeframe").not(this).css("color","grey")
        $(".timeframe").not(this).removeClass("selected")

        // mouseover function
        $(".timeframe").mouseover(function(){
        $(this).css("color","black")
        });

        $(".timeframe").mouseout(function(){
            if (!$(this).hasClass("selected")){
                $(this).css("color","grey")
            }
        });
    }
}

function checkError(){

    // add a baseline > goal error!

    if($("#weight").val().length>0 & isNaN($("#weight").val())){
        $("#weightError").css("visibility","visible");
    } else {
        // $("#errorsList li").eq(1).remove(); --> attempt to dynamically remove list items so that list always appear from same position under text
        $("#weightError").css("visibility","hidden");
    }

    if($("#units").val().length>0 & $("#units").val() != "kg" & $("#units").val() != "lbs"){
        $("#unitsError").css("visibility","visible");
    }
    else {
        $("#unitsError").css("visibility","hidden");
    }

    if($("#reps").val().length>0 & isNaN($("#reps").val())){
        $("#repsError").css("visibility","visible");
    } else {
        $("#repsError").css("visibility","hidden");
    }

    if($("#baselineWeight").val().length>0 & isNaN($("#baselineWeight").val())){
        $("#baselineWeightError").css("visibility","visible");
    } else {
        $("#baselineWeightError").css("visibility","hidden");
    }

}

function fillIcons() {

    // goal icon
    if($("#exercise").val().length>0 & $("#weight").val().length>0 & $("#weight").val()>0 & $("#reps").val().length>0 & $("#reps").val()>0 & ($("#units").val() == "kg" | $("#units").val() == "lbs")){
        $("#goal").css("opacity",1)
        $("#goal").css("width","55px")
        $("#goal").css("height","55px")
    } else {
        $("#goal").css("opacity",.3)
        $("#goal").css("width","50px")
        $("#goal").css("height","50px")
    }

    // baseline icon
    if($("#baselineWeight").val().length>0 & $("#baselineWeight").val()>0){
        $("#baseline").css("opacity",1)
        $("#baseline").css("width","55px")
        $("#baseline").css("height","55px")
    } else {
        $("#baseline").css("opacity",.3)
        $("#baseline").css("width","50px")
        $("#baseline").css("height","50px")
    }

    // timeframe icon (change to $('#timeframe').any)
    if($("#oneWeek").hasClass("selected") | $("#twoWeeks").hasClass("selected") | $("#oneMonth").hasClass("selected")){
        $("#timeframe").css("opacity",1)
        $("#timeframe").css("width","55px")
        $("#timeframe").css("height","55px")
        $("#incentive").css("opacity",1)
        $("#incentive").css("width","55px")
        $("#incentive").css("height","55px")
    } else {
        $("#timeframe").css("opacity",.3)
        $("#timeframe").css("width","50px")
        $("#timeframe").css("height","50px")
        $("#incentive").css("opacity",.3)
        $("#incentive").css("width","50px")
        $("#incentive").css("height","50px")
    }

    if($("#noteArea").val().length>0){
        $("#notes").css("opacity",1)
        $("#notes").css("width","55px")
        $("#notes").css("height","55px")
    } else {
        $("#notes").css("opacity",.3)
        $("#notes").css("width","50px")
        $("#notes").css("height","50px")
    }
}

function changeBackground(){
    if($(this).val().length>0){
        $(this).css('background-color','#8A94B9')
    } else {
        $(this).css('background-color','#C6C0CA')
    }
}

function sendGoalToDB(){
  $.ajax({
        url: "http://ec2-54-204-66-243.compute-1.amazonaws.com/admin/goals",
        type: "POST",
        data: liftObjectJSON,
        dataType: 'json', // lowercase is always preferered though jQuery does it, too.
        success: function(){},
        error: function(){}
    });
}

// Event Handlers

// $('window')
//     .scroll(freezeBanner) --> this didn't work

$('input[type="text"]')
    // event handler
    .keyup(resizeInput)
    .keyup(fillIcons)
    .keyup(checkError)
    .keyup(replaceBaseline)
    .keyup(changeBackground)
    .keyup(writeLiftObject)

    //resize on page load
    .each(startSizeInput)

$('.submit')
    .click(sendGoalToDB)

$('textarea')
    .keyup(fillIcons)

$('#reps')
    .keyup(changeTimes)

$(".timeframe")
    .click(toggleButtonColor)
    .click(changeIncentiveAmount)
    .click(fillIcons)
    .click(writeLiftObject)

</script>

</div>

</body>
</html>
